---
name: "Flat"

on: # yamllint disable-line rule:truthy
  push:
    branches:
      - "update_flat_workflow"

env:
  oui_branch_name: "flatbot_oui_update"

jobs:
  scheduled:
    runs-on: "ubuntu-latest"
    steps:
      # This step creates a branch for the flatbot to propose any changes to the oui file
      - name: "Create branch for flatbot"
        uses: peterjgrainger/action-create-branch@v2.2.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          branch: "flatbot_oui_update"
      # This step installs Deno, which is a new Javascript runtime that improves on Node. Can be used for an optional postprocessing step
      - name: "Setup deno"
        uses: "denoland/setup-deno@main"
        with:
          deno-version: "v1.10.x"
      # Check out the repository so it can read the files inside of it and do other operations
      - name: "Check out repo"
        uses: "actions/checkout@v2"
        with:
          ref: "flatbot_oui_update"
      # The Flat Action step. We fetch the data in the http_url and save it as downloaded_filename
      - name: "Fetch data"
        uses: "githubocto/flat@v3"
        with:
          http_url: "https://standards-oui.ieee.org"
          downloaded_filename: "./netutils/oui_mappings.py"
          postprocess: "./flat_postprocess/oui_postprocess.ts"
      - name: "Create a Pull Request"
        run: gh pr create -B develop -H flatbot_oui_update --title 'Flatbot OUI File Updates' --body 'Created by Flatbot action'
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      # # Create a PR into develop
      # - name: "Create Pull Request"
      #   uses: peter-evans/create-pull-request@v4
      #   with:
      #     title: "OUI File Updates"
      #     body: "Automated changes by the Github Action Flatbot"
      #     base: "develop"
      #     branch: "flatbot_oui_update"
